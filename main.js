(()=>{"use strict";var t={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},e=/^[A-Za-zА-Яа-яёЁ\- ]+$/,n=function(e,n,o){var r=e.querySelector(".".concat(n.name,"-input-error"));n.classList.add(t.inputErrorClass),r.textContent=o,r.classList.add(t.errorClass)},o=function(e,n){var o=e.querySelector(".".concat(n.name,"-input-error"));n.classList.remove(t.inputErrorClass),o.classList.remove(t.errorClass),o.textContent=""},r=function(n,o){!function(t){return t.some((function(t){return"url"===t.type?!t.validity.valid:!e.test(t.value)||!t.validity.valid}))}(n)?(o.disabled=!1,o.classList.remove(t.inactiveButtonClass)):(o.disabled=!0,o.classList.add(t.inactiveButtonClass))},c=function(){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()})),function(e){var c=Array.from(e.querySelectorAll(t.inputSelector)),a=e.querySelector(t.submitButtonSelector);c.forEach((function(t){t.addEventListener("input",(function(){!function(t,e){e.validity.patternMismatch?n(t,e,e.dataset.error):e.validity.valid?o(t,e):n(t,e,e.validationMessage)}(e,t),r(c,a)}))}))}(e)}))},a=function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),c=t.querySelector(e.submitButtonSelector);n.forEach((function(e){o(t,e)})),r(n,c)};c();var u=function(t){t.classList.add("popup_is-opened"),document.addEventListener("click",p),document.addEventListener("keydown",s)},i=function(e){e.classList.remove("popup_is-opened"),document.removeEventListener("click",p),document.removeEventListener("keydown",s),a(e,t),e.querySelector(".popup__form").reset()};function s(t){if("Escape"===t.key){var e=document.querySelector(".popup_is-opened");e&&i(e)}}function p(t){t.target.classList.contains("popup")&&i(t.target)}var l=document.querySelector("#card-template").content,d=document.querySelector(".popup_type_image"),f=document.querySelector(".popup__image"),m=document.querySelector(".popup__caption");function _(t){t.currentTarget.classList.toggle("card__like-button_is-active")}function v(t){f.src=t.target.src,m.textContent=t.target.alt,u(d)}function y(t){t.target.closest(".places__item").remove()}var h=function(t,e,n,o,r){var c=l.cloneNode(!0),a=c.querySelector(".card__title"),u=c.querySelector(".card__image");return u.src=t,u.alt=e,a.textContent=e,c.querySelector(".card__delete-button").addEventListener("click",n),c.querySelector(".card__like-button").addEventListener("click",o),c.querySelector(".card__image").addEventListener("click",r),c};function S(){return fetch("https://nomoreparties.co/v1/wff-cohort-39/users/me",{headers:{authorization:"ca811722-b39a-47f2-8683-a15951454f2a"}}).then((function(t){if(!t.ok)throw new Error("Ошибка: ".concat(t.status));return t.json()})).then((function(t){return t})).catch((function(t){throw console.error("Ошибка при загрузке данных пользователя:",t),t}))}S();var g=document.querySelector(".page"),q=document.querySelector(".places__list"),b=document.querySelector(".popup_type_edit"),L=document.querySelector(".popup_type_new-card"),E=document.querySelector(".popup__input_type_name"),C=document.querySelector(".popup__input_type_description"),k=document.querySelector(".popup_type_change_avatar"),w=document.querySelector(".popup__input_avatar_change"),j=document.querySelector(".profile__title"),x=document.querySelector(".profile__description"),A=document.querySelector(".profile__image");S().then((function(t){j.textContent=t.name,x.textContent=t.about,A.style.backgroundImage="url('".concat(t.avatar,"')")})).catch((function(t){console.error("Не удалось загрузить карточки:",t)})),fetch("https://nomoreparties.co/v1/wff-cohort-39/cards",{headers:{authorization:"ca811722-b39a-47f2-8683-a15951454f2a"}}).then((function(t){if(!t.ok)throw new Error("Ошибка: ".concat(t.status));return t.json()})).then((function(t){return t})).catch((function(t){throw console.error("Ошибка при загрузке карточек:",t),t})).then((function(t){t.forEach((function(t){q.append(h(t.link,t.name,y,_,v))}))})),g.addEventListener("click",(function(e){e.target.classList.contains("profile__edit-button")?(E.value=j.textContent,C.value=x.textContent,u(b)):e.target.classList.contains("profile__add-button")?u(L):e.target.classList.contains("profile__image")?u(k):e.target.classList.contains("popup__close")&&(i(e.target.closest(".popup")),a(e.target.closest(".popup"),t))}));var T=document.forms["edit-profile"],z=document.forms["new-place"],B=document.forms["new-avatar"];z.addEventListener("submit",(function(t){var e,n;t.preventDefault(),(e=document.querySelector(".popup__input_type_card-name").value,n=document.querySelector(".popup__input_type_url").value,fetch("https://nomoreparties.co/v1/wff-cohort-39/cards",{method:"POST",headers:{authorization:"ca811722-b39a-47f2-8683-a15951454f2a","Content-Type":"application/json"},body:JSON.stringify({name:e,link:n})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){throw console.error("Ошибка при создании карточки:",t),t}))).then((function(t){var e=h(t.link,t.name,y,_,v);q.prepend(e),z.reset(),i(L)})).catch((function(t){console.error("Ошибка при создании карточки:",t)}))})),z.addEventListener("input",(function(){return c()})),T.addEventListener("submit",(function(t){var e,n;t.preventDefault(),j.textContent=E.value,prifoleDescription.textContent=C.value,e=E.value,n=C.value,fetch("https://nomoreparties.co/v1/wff-cohort-39/users/me",{method:"PATCH",headers:{authorization:"ca811722-b39a-47f2-8683-a15951454f2a","Content-Type":"application/json"},body:JSON.stringify({name:e,about:n})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){throw console.error("Ошибка при обновлении профиля:",t),t})),i(b)})),T.addEventListener("input",(function(){return c()})),B.addEventListener("submit",(function(t){var e;t.preventDefault(),e=w.value,fetch("https://nomoreparties.co/v1/wff-cohort-39/users/me/avatar",{method:"PATCH",headers:{authorization:"ca811722-b39a-47f2-8683-a15951454f2a","Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){throw console.error("Ошибка при обновлении аватара:",t),t})),A.style.backgroundImage="url('".concat(w.value,"')"),i(k)})),B.addEventListener("input",(function(){return c()}))})();